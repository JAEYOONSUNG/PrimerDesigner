% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/design_grna_construct.R
\name{design_grna_construct}
\alias{design_grna_construct}
\title{Design gRNA Expression Construct (End-to-End Pipeline)}
\usage{
design_grna_construct(
  gRNA_df = NULL,
  genbank_file = NULL,
  genbank_accession = NULL,
  vector_file,
  start,
  end,
  locus_tags = NULL,
  nuclease = "GeoCas9",
  top_n = 1,
  cloning_method = "gibson",
  enzyme = "BbsI",
  custom_overhangs = NULL,
  tm_target = 60,
  overlap_length = 20,
  add_g = TRUE,
  name_pattern = "sgRNA_{locus_tag}_{method}_{dir}",
  output_file = NULL,
  output_dir = NULL,
  kill_snapgene = TRUE,
  methylation_patterns = NULL,
  dir = base::getwd(),
  position_range = c(5, 95),
  tm_range = c(50, 70),
  strand = "both"
)
}
\arguments{
\item{gRNA_df}{Optional. A pre-generated gRNA library data frame
(from \code{run_gRNA_list_generator}). If NULL (default), gRNAs are
auto-generated using \code{genbank_file} or \code{genbank_accession}.}

\item{genbank_file}{Character. Path to a local GenBank file (.gbff, .gb, .gbk).
The accession is extracted from the filename (e.g., \code{GCF_030376765.1.gbff}
→ \code{"GCF_030376765.1"}). The file is copied to \code{dir/seqs_srcdir/}
if not already there. Preferred over \code{genbank_accession}.}

\item{genbank_accession}{Character. GenBank accession number for auto-generation
(e.g., "GCF_030376765.1"). Files are downloaded if not present.
Used when \code{genbank_file} is not provided.}

\item{vector_file}{Path to the gRNA expression vector (.dna, .gb, .fasta).}

\item{start}{Integer. Stuffer/insertion site start position in the vector
(1-based, inclusive).}

\item{end}{Integer. Stuffer/insertion site end position in the vector
(1-based, inclusive).}

\item{locus_tags}{Character vector of target locus tags.
\itemize{
\item \code{"all"} — genome-wide, all genes, top_n per gene.
\item Single gene: \code{"QT234_RS00005"} — best gRNA within that gene.
\item Multi-gene region: \code{c("QT234_RS00005", "QT234_RS00010")} —
all gRNAs pooled and ranked globally (for region deletion).
}}

\item{nuclease}{Character. Nuclease name (default: "GeoCas9"). Also used for
methylation PAM-side determination.}

\item{top_n}{Integer. Number of best gRNAs to select (default: 1).
For multi-gene regions, top_n is global (not per gene).}

\item{cloning_method}{Character: "gibson" (IA, default) or "golden_gate" (OA).}

\item{enzyme}{Character. Golden Gate enzyme: "BbsI" (default), "BsaI", "BsmBI".}

\item{custom_overhangs}{Named list for custom overhangs (optional).}

\item{tm_target}{Numeric. Target Tm for Gibson primers (default: 60).}

\item{overlap_length}{Integer. Gibson overlap length (default: 20).}

\item{add_g}{Logical. Add 5' G for transcription (default: TRUE).}

\item{name_pattern}{Character. Primer naming template.
Default: \code{"sgRNA_{locus_tag}_g{rank}_{method}_{dir}"}.}

\item{output_file}{Character. Path to save primer Excel output (default: NULL).}

\item{output_dir}{Character. Directory to save GenBank files (default: NULL).}

\item{kill_snapgene}{Logical. Kill SnapGene before reading .dna (default: FALSE).}

\item{methylation_patterns}{Character vector of methylation recognition
sequences using IUPAC codes (default: NULL). Applied before gRNA selection.}

\item{dir}{Character. Working directory for auto-generation mode (default: getwd()).
BSgenome, bowtie index, and intermediate library are saved here.}

\item{position_range}{Numeric vector of length 2. gRNA position range as
percentage within target gene (default: c(5, 95)).}

\item{tm_range}{Numeric vector of length 2. gRNA Tm range (default: c(50, 70)).}

\item{strand}{Character. Strand filter ("both", "5", "3"; default: "both").}
}
\value{
A data frame with the selected gRNAs and their cloning primers.
}
\description{
All-in-one pipeline for CRISPR gRNA construct design. Supports three modes:
}
\details{
\strong{Mode 1a — From GenBank file (recommended):} Provide \code{genbank_file}
(path to a local .gbff file) and \code{locus_tags}. The accession is auto-extracted
from the filename. BSgenome/Bowtie are built in \code{dir}.

\strong{Mode 1b — From accession:} Provide \code{genbank_accession}
and \code{locus_tags}. Files are downloaded if not present.

\strong{Mode 2 — Pre-generated library:} Provide a pre-generated
\code{gRNA_df} from \code{run_gRNA_list_generator()}.

For multi-gene deletion targets (consecutive locus_tags, e.g.,
\code{c("RS00005", "RS00010")}), gRNAs from all specified genes are pooled
and the best \code{top_n} gRNA(s) are selected globally. This is the
standard workflow for region deletions: the gRNA cuts somewhere within
the deletion target to provide selection pressure.
}
\examples{
\dontrun{
# ====== From local GenBank file (recommended) ======
result <- design_grna_construct(
  genbank_file = "~/genomes/GCF_030376765.1.gbff",
  locus_tags  = "QT235_RS00005",
  nuclease    = "GeoCas9",
  vector_file = "~/vectors/pG1Kt-GeoCas9EF-OA-sfGFP-ACrec.dna",
  start = 8811, end = 8840,
  methylation_patterns = c("GCCAT", "CCANNNNNTTG"),
  dir = "~/Desktop/gRNA_project",
  output_file = "primers.xlsx",
  output_dir  = "constructs/"
)

# ====== Genome-wide from file ======
result <- design_grna_construct(
  genbank_file = "~/genomes/GCF_030376765.1.gbff",
  locus_tags  = "all",
  vector_file = "~/vectors/pG1Kt-GeoCas9EF-OA-sfGFP-ACrec.dna",
  start = 8811, end = 8840,
  top_n = 3,
  dir = "~/Desktop/gRNA_project",
  output_file = "genome_wide_primers.xlsx"
)

# ====== From accession (downloads if needed) ======
result <- design_grna_construct(
  genbank_accession = "GCF_030376765.1",
  locus_tags  = c("QT235_RS00005", "QT235_RS00010"),
  nuclease    = "GeoCas9",
  vector_file = "~/vectors/pG1Kt-GeoCas9EF-OA-sfGFP-ACrec.dna",
  start = 8811, end = 8840,
  top_n = 2,
  dir = "~/Desktop/gRNA_project",
  output_file = "region_primers.xlsx",
  output_dir  = "region_constructs/"
)

# ====== With pre-generated library (backward compatible) ======
result <- design_grna_construct(
  gRNA_df     = my_grna_lib,
  vector_file = "my_vector.dna",
  start = 8811, end = 8840,
  locus_tags  = "QT235_RS00005",
  output_file = "primers.xlsx"
)
}
}
